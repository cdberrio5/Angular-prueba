<h2>{{ data.task ? 'Editar Tarea' : 'Nueva Tarea' }}</h2>

<form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
  <!-- Título -->
  <mat-form-field appearance="fill">
    <mat-label>Título</mat-label>
    <input matInput id="title" formControlName="title" required />
    <mat-error *ngIf="taskForm.get('title')?.hasError('required')">El título es obligatorio</mat-error>
  </mat-form-field>

  <!-- Descripción -->
  <mat-form-field appearance="fill">
    <mat-label>Descripción</mat-label>
    <textarea matInput id="description" formControlName="description"></textarea>
  </mat-form-field>

  <!-- Fecha de vencimiento -->
  <mat-form-field appearance="fill">
    <mat-label>Fecha de Vencimiento</mat-label>
    <input matInput id="dueDate" type="date" formControlName="dueDate" required />
    <mat-error *ngIf="taskForm.get('dueDate')?.hasError('required')">La fecha es obligatoria</mat-error>
  </mat-form-field>

  <!-- Usuarios asignados -->
  <div formArrayName="assignedUsers">
    <h3>Usuarios Asignados</h3>

    <!-- Autocompletado para búsqueda de usuario -->
    <mat-form-field appearance="fill">
      <mat-label>Buscar Usuario</mat-label>
      <input type="text" placeholder="Buscar Usuario" matInput [matAutocomplete]="auto" [formControl]="userSearchControl">
      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onUserSelected($event.option.value)">
        <mat-option *ngFor="let user of filteredUsers" [value]="user">
          {{ user.name }} - {{ user.age }} años
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- Lista de usuarios agregados -->
    <div *ngFor="let user of assignedUsers.controls; let i = index" [formGroupName]="i" class="user-container">
      <mat-card>
        <mat-card-header>
          <mat-card-title>{{ user.get('name')?.value }}</mat-card-title>
          <mat-card-subtitle>Edad: {{ user.get('age')?.value }} años</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <h4>Habilidades:</h4>
          <ul>
            <li *ngFor="let skill of user.get('skills')?.value">{{ skill }}</li>
          </ul>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="warn" (click)="removeUser(i)">Eliminar Usuario</button>
        </mat-card-actions>
      </mat-card>
    </div>

    <button mat-raised-button color="primary" type="button" (click)="addUser()">Añadir Usuario</button>
  </div>

  <!-- Botones de acción -->
  <div class="action-buttons">
    <button mat-raised-button color="primary" type="submit" [disabled]="taskForm.invalid">Guardar</button>
    <button mat-raised-button type="button" (click)="onCancel()">Cancelar</button>
  </div>
</form>
