<form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
  <mat-card>
    <mat-card-content>
      <h2 mat-dialog-title>Detalle tarea</h2>
      <mat-form-field appearance="fill">
        <mat-label>Título</mat-label>
        <input matInput formControlName="title" />
      </mat-form-field>

      <!-- Descripción -->
      <mat-form-field appearance="fill">
        <mat-label>Descripción</mat-label>
        <textarea matInput formControlName="description"></textarea>
      </mat-form-field>

      <!-- Fecha de vencimiento -->
      <mat-form-field appearance="fill">
        <mat-label>Fecha de Vencimiento</mat-label>
        <input matInput formControlName="deadline" />
      </mat-form-field>

      <div formArrayName="assignedUsers">
        <h3>Usuarios Asignados</h3>

        <!-- Autocompletado para búsqueda de usuario -->
        <mat-form-field appearance="fill">
          <mat-label>Buscar Usuario</mat-label>
          <input type="text" placeholder="Buscar Usuario" matInput [matAutocomplete]="auto"
            [formControl]="userSearchControl" (input)="filterUsers(userSearchControl.value)" />
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onUserSelected($event.option.value)">
            <mat-option *ngFor="let user of filteredUsers" [value]="user">
              {{ user.fullName }} - {{ user.age }} años
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <!-- Lista de usuarios agregados -->
        <div *ngFor="let user of assignedUsers.controls; let i = index" [formGroupName]="i" class="user-container">
          <mat-card>
            <mat-card-header>
              <mat-card-title>{{ user.get('name')?.value }}</mat-card-title>
              <mat-card-subtitle>Edad: {{ user.get('age')?.value }} años</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <h4>Habilidades:</h4>
              <ul>
                <li *ngFor="let skill of user.get('skills')?.value">{{ skill }}</li>
              </ul>
            </mat-card-content>
            <mat-card-actions>
              <button mat-raised-button color="warn" (click)="removeUser(i)">Eliminar Usuario</button>
            </mat-card-actions>
          </mat-card>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="action-buttons">
        <button mat-raised-button type="submit">Guardar</button>
        <button mat-button (click)="onCancel()">Cancelar</button>
      </div>
    </mat-card-content>
  </mat-card>
</form>